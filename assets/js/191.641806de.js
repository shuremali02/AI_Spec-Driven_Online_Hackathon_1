"use strict";(globalThis.webpackChunkbook_write=globalThis.webpackChunkbook_write||[]).push([[191],{9191:(e,t,s)=>{s.d(t,{default:()=>x});var n=s(6540),o=s(4848);const i=({onClick:e,isOpen:t=!1})=>{const[s,i]=(0,n.useState)(!1);return(0,o.jsxs)("button",{className:`chatbot-floating-button ${t?"open":""} ${s?"hovered":""}`,onClick:e,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),"aria-label":t?"Close chat":"Open chat",title:t?"Close chat":"Open chatbot",children:[(0,o.jsx)("div",{className:"chatbot-icon",children:t?(0,o.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}):(0,o.jsxs)("svg",{width:"36",height:"36",viewBox:"0 0 200 200",xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsx)("rect",{x:"40",y:"30",width:"120",height:"100",rx:"20",fill:"white"}),(0,o.jsx)("rect",{x:"50",y:"45",width:"100",height:"70",rx:"12",fill:"rgba(102,126,234,0.15)"}),(0,o.jsx)("circle",{cx:"75",cy:"75",r:"15",fill:"white"}),(0,o.jsx)("circle",{cx:"125",cy:"75",r:"15",fill:"white"}),(0,o.jsx)("circle",{cx:"75",cy:"75",r:"8",fill:"rgba(102,126,234,0.6)"}),(0,o.jsx)("circle",{cx:"125",cy:"75",r:"8",fill:"rgba(102,126,234,0.6)"}),(0,o.jsx)("circle",{cx:"72",cy:"72",r:"3",fill:"white"}),(0,o.jsx)("circle",{cx:"122",cy:"72",r:"3",fill:"white"}),(0,o.jsx)("rect",{x:"70",y:"95",width:"60",height:"10",rx:"5",fill:"white",opacity:"0.8"}),(0,o.jsx)("rect",{x:"95",y:"10",width:"10",height:"25",rx:"5",fill:"white"}),(0,o.jsx)("circle",{cx:"100",cy:"10",r:"8",fill:"white",opacity:"0.9"}),(0,o.jsx)("rect",{x:"55",y:"135",width:"90",height:"50",rx:"10",fill:"white"}),(0,o.jsx)("rect",{x:"70",y:"145",width:"60",height:"8",rx:"4",fill:"rgba(102,126,234,0.3)"}),(0,o.jsx)("rect",{x:"70",y:"160",width:"40",height:"8",rx:"4",fill:"rgba(102,126,234,0.3)"}),(0,o.jsx)("rect",{x:"30",y:"140",width:"20",height:"35",rx:"8",fill:"white",opacity:"0.9"}),(0,o.jsx)("rect",{x:"150",y:"140",width:"20",height:"35",rx:"8",fill:"white",opacity:"0.9"}),(0,o.jsx)("circle",{cx:"40",cy:"180",r:"10",fill:"white"}),(0,o.jsx)("circle",{cx:"160",cy:"180",r:"10",fill:"white"})]})}),!t&&s&&(0,o.jsx)("span",{className:"chatbot-tooltip",children:"Chat with textbook"})]})};var r=s(4335);const a="https://shurem-ragchatbot.hf.space/v1",c=r.A.create({baseURL:a,timeout:3e4,headers:{"Content-Type":"application/json"}});c.interceptors.request.use(e=>{const t=localStorage.getItem("api_token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),c.interceptors.response.use(e=>e,e=>(console.error("API Error:",e),Promise.reject(e)));const l=async e=>(await c.post("/conversations",e)).data,d=async e=>(await c.get(`/conversations/${e}`)).data,h=async(e,t)=>(await c.post(`/conversations/${e}/messages`,t)).data,u=()=>{let e=localStorage.getItem("rag_chat_session");return e||(e=crypto.randomUUID(),localStorage.setItem("rag_chat_session",e)),e},m=({isOpen:e,onClose:t,initialConversation:s,initialQuery:i,onQueryProcessed:r})=>{const[a,c]=(0,n.useState)([]),[m,g]=(0,n.useState)(""),[x,w]=(0,n.useState)(!1),[p,y]=(0,n.useState)(s||null),j=(0,n.useRef)(null),v=(0,n.useRef)(!1);(0,n.useEffect)(()=>{k()},[a]),(0,n.useEffect)(()=>{i&&e&&!v.current&&!x&&(v.current=!0,g(i),setTimeout(()=>{f(i),r&&r()},100)),e||(v.current=!1)},[i,e]);const k=()=>{j.current?.scrollIntoView({behavior:"smooth"})},f=async e=>{if(!e.trim()||x)return;const t={id:Date.now().toString(),content:e,sender:"user",timestamp:new Date};c(e=>[...e,t]),g(""),w(!0);try{let t=p?.conversation_id;if(t){const s=await h(t,{content:e,message_type:"text-selection"}),n={id:s.message_id,content:s.content,sender:"system",timestamp:new Date(s.created_at),citations:s.citations||[]};c(e=>[...e,n])}else{const s=await l({session_id:u(),initial_query:e});y(s),t=s.conversation_id;const n=await d(t);if(n.messages&&n.messages.length>1){const e=n.messages.find(e=>"system"===e.sender_type);if(e){const t={id:e.message_id,content:e.content,sender:"system",timestamp:new Date(e.created_at),citations:e.citations||[]};c(e=>[...e,t])}}}}catch(s){console.error("Error sending message:",s);const e={id:(Date.now()+1).toString(),content:"Sorry, there was an error processing your message. Please try again.",sender:"system",timestamp:new Date};c(t=>[...t,e])}finally{w(!1)}},b=async()=>{if(!m.trim()||x)return;const e={id:Date.now().toString(),content:m,sender:"user",timestamp:new Date};c(t=>[...t,e]);const t=m;g(""),w(!0);try{let e=p?.conversation_id;if(e){const s=await h(e,{content:t,message_type:"query"}),n={id:s.message_id,content:s.content,sender:"system",timestamp:new Date(s.created_at),citations:s.citations||[]};c(e=>[...e,n])}else{const s=await l({session_id:u(),initial_query:t});y(s),e=s.conversation_id;const n=await d(e);if(n.messages&&n.messages.length>1){const e=n.messages.find(e=>"system"===e.sender_type);if(e){const t={id:e.message_id,content:e.content,sender:"system",timestamp:new Date(e.created_at),citations:e.citations||[]};c(e=>[...e,t])}}}}catch(s){console.error("Error sending message:",s);const e={id:(Date.now()+1).toString(),content:"Sorry, there was an error processing your message. Please try again.",sender:"system",timestamp:new Date};c(t=>[...t,e])}finally{w(!1)}};return e?(0,o.jsx)("div",{className:"chat-window-overlay",children:(0,o.jsxs)("div",{className:"chat-window",children:[(0,o.jsxs)("div",{className:"chat-header",children:[(0,o.jsx)("h3",{children:"Textbook Assistant"}),(0,o.jsx)("button",{className:"chat-close-button",onClick:t,children:(0,o.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),(0,o.jsxs)("div",{className:"chat-messages",children:[0===a.length?(0,o.jsx)("div",{className:"chat-welcome-message",children:(0,o.jsx)("p",{children:"Hello! I'm your textbook assistant. Ask me anything about the Physical AI & Humanoid Robotics content, and I'll provide answers based on the textbook with citations."})}):a.map(e=>(0,o.jsxs)("div",{className:"chat-message "+("user"===e.sender?"user-message":"system-message"),children:[(0,o.jsx)("div",{className:"message-content",children:e.content}),e.citations&&e.citations.length>0&&(0,o.jsxs)("div",{className:"message-citations",children:[(0,o.jsx)("strong",{children:"Citations:"}),(0,o.jsx)("ul",{children:e.citations.map((e,t)=>(0,o.jsx)("li",{children:(0,o.jsxs)("a",{href:e.url_path,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),children:[e.chapter_title," - ",e.section_title]})},t))})]}),(0,o.jsx)("div",{className:"message-timestamp",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},e.id)),x&&(0,o.jsx)("div",{className:"chat-message system-message",children:(0,o.jsx)("div",{className:"message-content",children:(0,o.jsxs)("div",{className:"typing-indicator",children:[(0,o.jsx)("span",{}),(0,o.jsx)("span",{}),(0,o.jsx)("span",{})]})})}),(0,o.jsx)("div",{ref:j})]}),(0,o.jsxs)("div",{className:"chat-input-area",children:[(0,o.jsx)("textarea",{value:m,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),b())},placeholder:"Ask a question about the textbook...",disabled:x,rows:2}),(0,o.jsx)("button",{onClick:b,disabled:!m.trim()||x,className:"send-button",children:(0,o.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)("path",{d:"M22 2L11 13M22 2L15 22L11 13M11 13L2 9L22 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]})}):null},g=({onAskAboutSelection:e})=>{const[t,s]=(0,n.useState)(!1),[i,r]=(0,n.useState)({x:0,y:0}),[a,c]=(0,n.useState)(""),l=(0,n.useRef)(null),d=(0,n.useRef)(!1),h=(0,n.useCallback)(()=>{const e=window.getSelection(),t=e?.toString().trim();if(t&&t.length>3&&t.length<1e3)try{const n=e?.getRangeAt(0),o=n?.getBoundingClientRect();if(o&&o.width>0){const e=o.left+o.width/2,n=o.top-10;r({x:e,y:n}),c(t),s(!0),d.current=!0,setTimeout(()=>{d.current=!1},200)}}catch(n){console.log("Selection error:",n)}else d.current||(s(!1),c(""))},[]),u=(0,n.useCallback)(e=>{l.current?.contains(e.target)||setTimeout(()=>{h()},10)},[h]),m=(0,n.useCallback)(e=>{d.current||l.current&&!l.current.contains(e.target)&&s(!1)},[]),g=(0,n.useCallback)(()=>{s(!1)},[]),x=(0,n.useCallback)(e=>{"Escape"===e.key&&s(!1)},[]),w=(0,n.useCallback)(e=>{l.current?.contains(e.target)||setTimeout(()=>{h()},300)},[h]),p=(0,n.useCallback)(()=>{setTimeout(()=>{const e=window.getSelection(),t=e?.toString().trim();t&&t.length>3&&h()},500)},[h]);(0,n.useEffect)(()=>(document.addEventListener("mouseup",u),document.addEventListener("mousedown",m),document.addEventListener("touchend",w),document.addEventListener("selectionchange",p),document.addEventListener("scroll",g,!0),document.addEventListener("keydown",x),()=>{document.removeEventListener("mouseup",u),document.removeEventListener("mousedown",m),document.removeEventListener("touchend",w),document.removeEventListener("selectionchange",p),document.removeEventListener("scroll",g,!0),document.removeEventListener("keydown",x)}),[u,m,w,p,g,x]);const y=t=>{t.preventDefault(),t.stopPropagation(),a&&(e(a),s(!1),c(""),window.getSelection()?.removeAllRanges())};return t?(0,o.jsxs)("div",{ref:l,className:"text-selection-popup",style:{left:`${i.x}px`,top:`${i.y}px`},onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:[(0,o.jsxs)("button",{className:"ask-button",onClick:y,onTouchEnd:y,onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:[(0,o.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsx)("path",{d:"M8.5 19H8C4 19 2 18 2 13V8C2 4 4 2 8 2H16C20 2 22 4 22 8V13C22 17 20 19 16 19H15.5C15.19 19 14.89 19.15 14.7 19.4L13.2 21.4C12.54 22.28 11.46 22.28 10.8 21.4L9.3 19.4C9.14 19.18 8.77 19 8.5 19Z",stroke:"currentColor",strokeWidth:"1.5",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)("path",{d:"M12 11V11.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)("path",{d:"M12 8C10.34 8 9 6.66 9 5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),"Ask about this"]}),(0,o.jsx)("div",{className:"popup-arrow"})]}):null},x=()=>{const[e,t]=(0,n.useState)(!1),[s,r]=(0,n.useState)(null);return(0,o.jsxs)("div",{className:"chatbot-container "+(e?"chat-open":""),children:[(0,o.jsx)(g,{onAskAboutSelection:e=>{r(`Explain this: "${e}"`),t(!0)}}),(0,o.jsx)(i,{onClick:()=>{t(!e)},isOpen:e}),(0,o.jsx)(m,{isOpen:e,onClose:()=>{t(!1)},initialQuery:s,onQueryProcessed:()=>{r(null)}})]})}}}]);